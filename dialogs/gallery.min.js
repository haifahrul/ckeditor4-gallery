function removeDomainFromUrl(e){"use strict";return e.replace(/^https?:\/\/[^\/]+/i,"")}function var_dump(e,t){"use strict";var i="";t||(t=0);var n,r,a,l="";for(n=0;n<t+1;n+=1)l+="    ";if("object"==typeof e)for(r in e)e.hasOwnProperty(r)&&(a=e[r],"object"==typeof a?(i+=l+"'"+r+"' ...\n",i+=var_dump(a,t+1)):i+=l+"'"+r+"' => \""+a+'"\n');else i="===>"+e+"<===("+typeof e+")";return i}var IMG_PARAM={URL:0,TITLE:1,ALT:2,WIDTH:3,HEIGHT:4},pluginPath=removeDomainFromUrl(CKEDITOR.plugins.get("gallery").path),BASE_PATH=removeDomainFromUrl(CKEDITOR.basePath),JQUERY_SCRIPT=pluginPath+"vendor/jquery.min.js",VIEWER_JS=pluginPath+"vendor/viewer/viewer.min.js",VIEWER_CSS=pluginPath+"vendor/viewer/viewer.min.css",GALLERY_CSS=pluginPath+"styles/gallery.min.css",listItem=function(e){"use strict";return e.type==CKEDITOR.NODE_ELEMENT&&e.is("li")},ULItem=function(e){"use strict";return e.type==CKEDITOR.NODE_ELEMENT&&e.is("ul")},iFrameItem=function(e){"use strict";return e.type==CKEDITOR.NODE_ELEMENT&&e.is("iframe")};Array.prototype.pushUnique=function(e){"use strict";var t;for(t=0;t<this.length;t+=1)if(this[t][0]==e[0])return-1;return this.push(e),this.length-1},Array.prototype.updateVal=function(e,t){"use strict";var i;for(i=0;i<this.length;i+=1)if(this[i][0]==e)return this[i]=[e,t],!0;return this[i]=[e,t],!1},Array.prototype.getVal=function(e){"use strict";var t;for(t=0;t<this.length;t+=1)if(this[t][0]==e)return this[t][1];return null},CKEDITOR.dialog.add("galleryDialog",function(e){"use strict";function t(e,t,i,n,r){var a;return e=s(e),a=n?n.createElement("OPTION"):document.createElement("OPTION"),!(!e||!a||"option"!=a.getName())&&(CKEDITOR.env.ie?(isNaN(parseInt(r,10))?e.$.options.add(a.$):e.$.options.add(a.$,r),a.$.innerHTML=t.length>0?t:"",a.$.value=i):(null!==r&&r<e.getChildCount()?e.getChild(r<0?0:r).insertBeforeMe(a):e.append(a),a.setText(t.length>0?t:""),a.setValue(i)),a)}function i(e,t,i,n){if(e=s(e),t<0)return!1;var r=e.getChild(t);return r.setText(i),r.setValue(n),r}function n(e){for(e=s(e);e.getChild(0)&&e.getChild(0).remove(););}function r(e,n,r,o){e=s(e);var g=a(e);if(g<0)return!1;var u=g+n;if(u=u<0?0:u,u=u>=e.getChildCount()?e.getChildCount()-1:u,g==u)return!1;var c=/(^IMG_\d+)/,d=e.getChild(u),m=d.getText(),p=d.getValue();m=m.replace(c,"IMG_"+g),i(e,u,m,p),d=e.getChild(g),m=d.getText(),p=d.getValue(),d.remove(),m=m.replace(c,"IMG_"+u),d=t(e,m,p,r||null,u),l(e,u);var h=o.imagesList[g],v=o.imagesList[u];return o.imagesList[g]=v,o.imagesList[u]=h,d}function a(e){return e=s(e),e?e.$.selectedIndex:-1}function l(e,t){if(e=s(e),t<0)return null;var i=e.getChildren().count();return e.$.selectedIndex=t>=i?i-1:t,e}function s(e){return e&&e.domId&&e.getInputElement().$?e.getInputElement():!(!e||!e.$)&&e}function o(e){if(1!=e.openCloseStep){var t=e.getContentElement("gallery-content-id","frame-preview-id");t.isVisible()&&m(e)}}function g(e){var t=BASE_PATH+"plugins/gallery/images/placeholder.png";if(1==e.imagesList.length&&e.imagesList[0][IMG_PARAM.URL]==t){var i=e.getContentElement("gallery-content-id","img-items-id");i=s(i);var n=0;e.imagesList.splice(n,1),i.getChild(n).remove()}}function u(e){g(e);var i=e.previewImage,n=i.$.src,r=e.getContentElement("gallery-content-id","img-items-id"),a=e.imagesList.pushUnique([n]);a>=0&&(t(r,"IMG_"+a+" : "+n.substring(n.lastIndexOf("/")+1),n,e.getParentEditor().document),l(r,a),o(e))}function c(e){var i=e.getContentElement("gallery-content-id","img-items-id");i=s(i);var n,r=!1;for(n=i.getChildren().count()-1;n>=0;n--)i.getChild(n).$.selected&&(e.imagesList.splice(n,1),i.getChild(n).remove(),r=!0);if(r){if(0==e.imagesList.length){var a=BASE_PATH+"plugins/gallery/images/placeholder.png";t(i,"IMG_0 : "+a.substring(a.lastIndexOf("/")+1),a,e.getParentEditor().document);e.imagesList.pushUnique([a,A.imgTitle,A.imgDesc,"50","50"])}l(i,0),o(e)}}function d(e,t){var i=e.getContentElement("gallery-content-id","img-items-id");i=s(i);var n=a(i);1!=i.getChildren().count()&&(-1==t&&0==n||1==t&&n==i.getChildren().count()-1||(r(i,t,e.getParentEditor().document,e),h(e)))}function m(e){var t=e.getContentElement("gallery-content-id","frame-preview-id");t=s(t),t.show(),h(e)}function p(e,t){e.open(),e.writeln(t),e.close()}function h(t){var i=100,n=300;if(1==t.params.getVal("showthumbid")?n-=120:1==t.params.getVal("showcontrolid")&&(n-=30),0!=t.imagesList.length){var r=t.getContentElement("gallery-content-id","img-items-id"),l=a(r);l<0&&(l=0),r=t.getContentElement("gallery-content-id","frame-preview-id");var o="",g='<script src="'+JQUERY_SCRIPT+'" type="text/javascript"></script>';o+="<head>",e.config.galleryDoNotLoadJquery&&1==e.config.galleryDoNotLoadJquery&&(g=""),o+=g,o+='<script type="text/javascript" src="'+VIEWER_JS+'"></script>',o+='<link rel="stylesheet" type="text/css" href="'+VIEWER_CSS+'" />',o+='<link rel="stylesheet" type="text/css" href="'+GALLERY_CSS+'" />',o+='<script type="text/javascript">',o+=w(t,l,i,n),o+="</script>",o+="</head>",o+="<body>";var u=x(t);o+=u.getOuterHtml(),o+="</body>",o+="",r=s(r);var c=r.getFirst(iFrameItem);c&&c.remove();var d=null,m=n;1==t.params.getVal("showthumbid")?m+=120:1==t.params.getVal("showcontrolid")&&(m+=30);var h=CKEDITOR.dom.element.createFromHtml('<iframe style="width:'+i+"%;height:"+m+'px;background:azure; " class="cke_pasteframe" frameborder="10"  allowTransparency="false" role="region" scrolling="no"></iframe>');h.setAttribute("name","preview"),h.setAttribute("id","preview"),h.on("load",function(e){var t;null==d&&(d=this.$,d.contentDocument?t=d.contentDocument:d.contentWindow&&(t=d.contentWindow.document),t?p(t,o):alert("Cannot inject dynamic contents into iframe."))}),r.append(h)}}function v(e,i){var n,r,a,s,g,u,c,d,m,p=i.$.getElementsByTagName("img"),h=e.getContentElement("gallery-content-id","img-items-id");for(n=0;n<p.length;n+=1){r=p[n],a=r.src,s=r.width,0==s&&(s=r.naturalWidth),0==s?(s=50,g=50):(g=r.height,0==g&&(g=r.naturalHeight),0==g&&(s=50,g=50)),u=s/g,c=50,d=50,u>1?d/=u:c*=u,m=e.imagesList.pushUnique([a,r.title,r.alt,c,d]),m>=0&&t(h,"IMG_"+m+" : "+a.substring(a.lastIndexOf("/")+1),a,e.getParentEditor().document)}l(h,0),o(e)}function f(e){var i=e.getContentElement("gallery-content-id","img-items-id"),n=BASE_PATH+"plugins/gallery/images/placeholder.png";t(i,"IMG_0 : "+n.substring(n.lastIndexOf("/")+1),n,e.getParentEditor().document);e.imagesList.pushUnique([n,A.imgTitle,A.imgDesc,"100","100"]),l(i,0),o(e)}function y(){var e=this.getDialog();if(e.newGalleryMode)e.galleryDOM.setAttribute("data-"+this.id,this.getValue()),this.type;else switch(this.type){case"checkbox":this.setValue("true"==e.galleryDOM.getAttribute("data-"+this.id));break;case"text":case"select":this.setValue(e.galleryDOM.getAttribute("data-"+this.id))}}function b(){var e=this.getDialog();e.params.updateVal(this.id,this.getValue()),this.type,o(e)}function E(e){e.previewImage&&(e.previewImage.removeListener("load",R),e.previewImage.removeListener("error",_),e.previewImage.removeListener("abort",_),e.previewImage.remove(),e.previewImage=null),e.imagesList=null,e.params=null,e.galleryDOM=null;var t=e.getContentElement("gallery-content-id","img-items-id");n(t),e.openCloseStep=!1}function I(e){for(var t="";t.length<e;)t+=Math.random().toString(36).substring(2);return t.substring(0,e)}function C(e,t){var i=t.getElementsByTag("ul");return null==i?null:1==i.count()?i.getItem(0):null}function w(e,t,i,n){var r="(function($) {";return r+="$(function() {",r+=L(e),r+="});",r+="})(jQuery);",r}function L(e){const t="{ inline: false,button: "+e.params.getVal("viewerButton")+",interval: "+e.params.getVal("viewerInterval")+"}";var i=e.params.getVal("galleryid");return"const galleries = new Viewer(document.getElementById('"+i+"_images'), "+t+");"}function x(t){var i=t.params.getVal("galleryid");t.params.getVal("showthumbid"),t.params.getVal("showcontrolid");var n=e.document.createElement("div");n.setAttribute("id",i),n.setAttribute("class","galleryPlugin"),n.setAttribute("contenteditable","false");var r=n.append("ul");return r.setAttribute("id",i+"_images"),r.setAttribute("class","ckeditor-gallery-images clearfix"),D(t,r),n}function D(e,t){var i,n,r;for(i=0;i<e.imagesList.length;i+=1)n=t.append("li"),n.setAttribute("contenteditable","false"),r=n.append("img"),r.setAttribute("src",removeDomainFromUrl(e.imagesList[i][IMG_PARAM.URL])),r.setAttribute("title",e.imagesList[i][IMG_PARAM.TITLE]),r.setAttribute("alt",e.imagesList[i][IMG_PARAM.ALT]),r.setAttribute("contenteditable","false")}function T(t){var i={},n={};t.openCloseStep=!0,t.commitContent(t);var r,a=x(t);for(r=0;r<t.params.length;r+=1)a.data(t.params[r][0],t.params[r][1]);if(!e.config.galleryDoNotLoadJquery||1!=e.config.galleryDoNotLoadJquery){var l=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript",src:JQUERY_SCRIPT}});a.append(l)}var s=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript",src:VIEWER_JS}});a.append(s);var o=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}});o.setText(`(function($) { ${L(t)} })(jQuery);`),a.append(o);var g=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}});g.setText("(function($) { $('head').append('<link rel=\"stylesheet\" href=\""+VIEWER_CSS+'" type="text/css" />\'); })(jQuery);'),a.append(g);var u=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}});u.setText("(function($) { $('head').append('<link rel=\"stylesheet\" href=\""+GALLERY_CSS+'" type="text/css" />\'); })(jQuery);'),a.append(u),t.imagesList.length&&(i.backgroundImage='url("'+t.imagesList[0][IMG_PARAM.URL]+'")'),i.backgroundSize="contain",i.backgroundRepeat="no-repeat",i.backgroundPosition="center",i.display="block",i.width="64px",i.height="64px",i.border="1px solid black";var c=e.createFakeElement(a,"cke_gallery","gallery",!1);return c.setAttributes(n),c.setStyles(i),t.fakeImage?(c.replace(t.fakeImage),e.getSelection().selectElement(c)):e.insertElement(c),E(t),t.hide(),!0}var A=e.lang.gallery,R=function(){var e=this.previewImage;e.removeListener("load",R),e.removeListener("error",_),e.removeListener("abort",_),u(this)},_=function(){var e=this.previewImage;e.removeListener("load",R),e.removeListener("error",_),e.removeListener("abort",_)},k=function(e){return"cke_"+I(8)+"_"+e};return{title:A.dialogTitle,width:500,height:600,resizable:CKEDITOR.DIALOG_RESIZE_NONE,buttons:[CKEDITOR.dialog.okButton(e,{id:"my-ok-btn",type:"button",label:"OK",title:A.validModif,accessKey:"C",disabled:!1,onClick:function(){T(this.getDialog())}}),CKEDITOR.dialog.cancelButton],contents:[{id:"gallery-content-id",label:"Basic Settings",align:"center",elements:[{type:"text",id:"txt-url-id",style:"display:none;",label:A.imgList,onChange:function(){var e=this.getDialog(),t=this.getValue();if(t.length>0){var i=e.previewImage;i.on("load",R,e),i.on("error",_,e),i.on("abort",_,e),i.setAttribute("src",t)}}},{type:"button",id:"browse",hidden:"true",style:"display:inline-block;",filebrowser:{action:"Browse",target:"gallery-content-id:txt-url-id",url:e.config.filebrowserImageBrowseUrl||e.config.filebrowserBrowseUrl},label:A.imgAdd},{type:"vbox",align:"center",children:[{type:"html",id:"frame-preview-id",align:"center",style:"width:500px;height:320px",html:""},{type:"hbox",align:"center",height:150,widths:["85%","15%"],children:[{type:"select",id:"img-items-id",label:A.picturesList,multiple:!1,items:[],width:"100%",style:"height:125px;"},{type:"vbox",style:"padding-top: 15px;",children:[{type:"button",id:"rm-selected-btn",label:A.imgDelete,onClick:function(){c(this.getDialog())}},{type:"hbox",children:[{type:"button",id:"up-seleced-btn",label:A.imgUp,onClick:function(){d(this.getDialog(),-1)}},{type:"button",id:"down-selected-btn",style:"margin-top: 0;",label:A.imgDown,onClick:function(){d(this.getDialog(),1)}}]}]}]},{type:"hbox",align:"center",children:[{type:"vbox",children:[{type:"checkbox",id:"viewerButton",label:A.viewerButton,default:"checked",onChange:b,commit:b,setup:y},{type:"checkbox",id:"viewerLoading",label:A.viewerLoading,default:"checked",onChange:b,commit:b,setup:y},{type:"checkbox",id:"viewerMovable",label:A.viewerMovable,default:"checked",onChange:b,commit:b,setup:y}]}]},{type:"hbox",children:[{type:"text",id:"viewerInterval",label:A.viewerInterval,style:"width:100px;",maxLength:4,default:"5000",onChange:function(e){var t=/^\d+$/;0==t.test(this.getValue())&&this.setValue(5e3),this.getDialog().params.updateVal(this.id,this.getValue()),o(this.getDialog())},commit:b,setup:y}]}]}]}],onLoad:function(){},onShow:function(){this.dialog=this,this.galleryDOM=null,this.openCloseStep=!0,this.fakeImage=null;var t=null;this.imagesList=[],this.params=[],this.previewImage=e.document.createElement("img"),this.okRefresh=!0;var i=this.getSelectedElement();if(i&&i.data("cke-real-element-type")&&"gallery"==i.data("cke-real-element-type")&&(this.fakeImage=i,t=e.restoreRealElement(i)),t){this.galleryDOM=t;var n=C(this,t);if(null==n)return alert("BIG Problem galleryContainer !!"),!1;var r=t.getAttribute("id");if(null==r)return alert("BIG Problem galleryid !!"),!1;this.params.push(["galleryid",r]),v(this,n);var a,l=t.$.dataset;for(a in l)this.params.push([a,l[a]]);this.setupContent(this,!0),h(this),this.newGalleryMode=!1}else this.params.push(["galleryid",k("gallery")]),f(this),this.commitContent(this);this.openCloseStep=!1,m(this)},onOk:function(){return!1},onHide:function(){E(this)}}});